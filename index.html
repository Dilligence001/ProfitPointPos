<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Offline POS System</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --wallpaper: none;
            --text-color: #2c3e50;
            --card-bg: rgba(255, 255, 255, 0.92);
            --border-color: #ddd;
            --hover-transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            font-size: 14px;
            background-image: var(--wallpaper);
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            transition: background-image 0.5s ease, color 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        /* Login Styles */
        .login-container {
            width: 100%;
            max-width: 400px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-header {
            background: linear-gradient(135deg, var(--primary), #1a2530);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .login-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .login-header p {
            opacity: 0.8;
            font-size: 14px;
        }

        .login-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .user-type-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .user-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--hover-transition);
            background: var(--card-bg);
        }

        .user-option:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .user-option.selected {
            border-color: var(--secondary);
            background-color: rgba(52, 152, 219, 0.05);
        }

        .user-option input {
            margin-right: 10px;
        }

        .user-option .user-details {
            flex: 1;
        }

        .user-option .user-name {
            font-weight: 500;
            margin-bottom: 2px;
            color: var(--text-color);
        }

        .user-option .user-role {
            font-size: 12px;
            color: var(--gray);
        }

        .btn {
            padding: 12px 15px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--hover-transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: #d5dbdb;
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #219955;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }

        .btn-info {
            background-color: var(--info);
            color: white;
        }

        .btn-info:hover {
            background-color: #138496;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            color: var(--danger);
            font-size: 13px;
            margin-top: 5px;
            text-align: center;
        }

        .login-footer {
            text-align: center;
            padding: 15px;
            border-top: 1px solid var(--border-color);
            font-size: 12px;
            color: var(--gray);
        }

        .system-info {
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 15px;
            border-radius: var(--radius);
            margin-top: 15px;
            font-size: 12px;
            text-align: center;
        }

        /* Main App Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary), #1a2530);
            color: white;
            padding: 12px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .app-nav {
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            position: sticky;
            top: 60px;
            z-index: 99;
        }

        .nav-tabs {
            display: flex;
            list-style: none;
            overflow-x: auto;
            white-space: nowrap;
        }

        .nav-tab {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--hover-transition);
            font-weight: 500;
            color: var(--text-color);
        }

        .nav-tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
        }

        /* POS Terminal Styles */
        .pos-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
        }

        .search-container {
            margin-bottom: 15px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 16px;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            color: var(--text-color);
        }

        .quick-access {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
        }

        .quick-access-item {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 12px;
            box-shadow: var(--shadow);
            cursor: pointer;
            text-align: center;
            transition: var(--hover-transition);
            min-width: 110px;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }

        .quick-access-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 12px;
            box-shadow: var(--shadow);
            cursor: pointer;
            text-align: center;
            transition: var(--hover-transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 140px; /* Consistent height */
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .product-card img {
            max-width: 100%;
            height: 80px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .product-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text-color);
        }

        .product-price {
            color: var(--success);
            font-weight: 600;
            font-size: 14px;
        }

        .product-stock {
            font-size: 12px;
            color: var(--gray);
            margin-top: 5px;
        }

        .cart-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 120px;
            height: fit-content;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
        }

        .cart-item-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-total {
            font-size: 18px;
            font-weight: 600;
            text-align: right;
            margin: 15px 0;
            padding-top: 15px;
            border-top: 2px solid var(--border-color);
            color: var(--text-color);
        }

        .payment-section {
            margin-top: 15px;
        }

        .payment-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .payment-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background: var(--card-bg);
            color: var(--text-color);
        }

        .change-display {
            background-color: var(--light);
            padding: 10px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            color: var(--text-color);
        }

        .payment-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .payment-actions .btn {
            flex: 1;
            min-width: 120px;
        }

        /* Manager App Styles */
        .manager-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
        }

        .manager-sidebar {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .manager-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
        }

        .manager-menu {
            list-style: none;
        }

        .manager-menu-item {
            padding: 12px 15px;
            cursor: pointer;
            border-radius: var(--radius);
            margin-bottom: 5px;
            transition: var(--hover-transition);
            color: var(--text-color);
        }

        .manager-menu-item:hover {
            background-color: var(--light);
        }

        .manager-menu-item.active {
            background-color: var(--secondary);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--border-color);
            height: 120px; /* Consistent height */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 600;
            margin: 10px 0;
            color: var(--text-color);
        }

        .stat-label {
            color: var(--gray);
            font-size: 13px;
        }

        .table-container {
            overflow-x: auto;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        th {
            background-color: var(--light);
            font-weight: 600;
        }

        /* Status Classes */
        .status-online {
            color: var(--success);
        }

        .status-offline {
            color: var(--danger);
        }

        .status-warning {
            color: var(--warning);
        }

        .status-info {
            color: var(--info);
        }

        /* Terminal Management */
        .terminal-list {
            list-style: none;
        }

        .terminal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }

        .terminal-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .terminal-actions {
            display: flex;
            gap: 8px;
        }

        /* Receipt Styles */
        .receipt {
            background: white;
            padding: 20px;
            max-width: 300px;
            margin: 0 auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px dashed #ccc;
        }

        .receipt-header, .receipt-footer {
            text-align: center;
            margin-bottom: 10px;
        }

        .receipt-items {
            margin: 10px 0;
            border-top: 1px dashed #000;
            border-bottom: 1px dashed #000;
            padding: 10px 0;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .receipt-total {
            font-weight: bold;
            border-top: 1px dashed #000;
            padding-top: 5px;
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .pos-container {
                grid-template-columns: 1.5fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .pos-container, .manager-container {
                grid-template-columns: 1fr;
            }
            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .nav-tabs {
                flex-wrap: nowrap;
            }
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .quick-access-item {
                min-width: 100px;
            }
            .manager-sidebar {
                position: static;
            }
            .cart-container {
                position: static;
                max-height: none;
            }
            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            .quick-access-item {
                min-width: 90px;
                padding: 8px;
            }
            .product-card {
                padding: 8px;
                height: 130px;
            }
            .nav-tab {
                padding: 10px 12px;
                font-size: 14px;
            }
            .payment-actions {
                flex-direction: column;
            }
            .payment-actions .btn {
                width: 100%;
            }
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .receipt, .receipt * {
                visibility: visible;
            }
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                border: none;
                box-shadow: none;
            }
        }

        /* Store Logo */
        .store-logo {
            max-height: 40px;
            max-width: 150px;
            object-fit: contain;
        }

        /* Customization Preview */
        .customization-preview {
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            background: var(--card-bg);
        }

        .preview-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .preview-logo {
            max-height: 40px;
            max-width: 100px;
            object-fit: contain;
        }

        .preview-motto {
            font-style: italic;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .wallpaper-preview {
            width: 100%;
            height: 100px;
            background-size: cover;
            background-position: center;
            border-radius: var(--radius);
            margin-top: 10px;
            border: 1px solid var(--border-color);
        }

        /* New Features */
        .inventory-alert {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: var(--radius);
            margin-bottom: 15px;
        }

        .discount-section {
            margin: 15px 0;
        }

        .discount-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .discount-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background: var(--card-bg);
            color: var(--text-color);
        }

        .customer-section {
            margin: 15px 0;
        }

        .customer-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .customer-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            background: var(--card-bg);
            color: var(--text-color);
        }

        .customer-info {
            background-color: var(--light);
            padding: 10px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .loyalty-points {
            background-color: #e8f4fd;
            padding: 10px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            text-align: center;
            color: var(--text-color);
        }

        .featured-products {
            margin: 20px 0;
        }

        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
        }

        .featured-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 12px;
            box-shadow: var(--shadow);
            cursor: pointer;
            text-align: center;
            transition: var(--hover-transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 140px; /* Consistent height */
        }

        .featured-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .featured-badge {
            background-color: var(--warning);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-bottom: 5px;
            display: inline-block;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
        }

        .chart-placeholder {
            height: 200px;
            background-color: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            color: var(--gray);
            border: 1px dashed var(--border-color);
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .export-options .btn {
            flex: 1;
        }

        .inventory-warning {
            color: var(--danger);
            font-weight: 600;
        }

        .low-stock {
            background-color: #ffeaa7;
        }

        .out-of-stock {
            background-color: #fab1a0;
        }

        .category-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .category-btn {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 8px 12px;
            cursor: pointer;
            transition: var(--hover-transition);
            white-space: nowrap;
            color: var(--text-color);
        }

        .category-btn.active {
            background-color: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .category-btn:hover:not(.active) {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* Manager Cards - Consistent Sizing */
        .manager-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            height: 150px; /* Consistent height for all manager cards */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Quick Access Setup Cards */
        .quick-access-card {
            height: 180px; /* Consistent height for quick access cards */
        }

        /* Form Elements */
        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }

        select.form-control {
            cursor: pointer;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Login Interface -->
    <div id="loginSection" class="login-container">
        <div class="login-header">
            <h1 id="loginStoreName">POS System</h1>
            <p>Secure Login</p>
        </div>

        <div class="login-body">
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter your username" required>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>

                <div class="user-type-selector">
                    <div class="user-option" data-role="cashier">
                        <input type="radio" id="cashier" name="userType" value="cashier">
                        <div class="user-details">
                            <div class="user-name">Cashier</div>
                            <div class="user-role">Access to POS Terminal only</div>
                        </div>
                    </div>

                    <div class="user-option" data-role="manager">
                        <input type="radio" id="manager" name="userType" value="manager">
                        <div class="user-details">
                            <div class="user-name">Manager</div>
                            <div class="user-role">Access to Manager App only</div>
                        </div>
                    </div>

                    <div class="user-option" data-role="admin">
                        <input type="radio" id="admin" name="userType" value="admin">
                        <div class="user-details">
                            <div class="user-name">Administrator</div>
                            <div class="user-role">Access to Settings only</div>
                        </div>
                    </div>
                </div>

                <div id="errorMessage" class="error-message hidden">Invalid credentials or user role selection</div>

                <button type="submit" class="btn btn-primary">Login</button>
            </form>
        </div>

        <div class="login-footer">
            <p>POS System v1.0 powered by SevenSquare</p>
            <div class="system-info">
                System Status: <span style="color: var(--success);">●</span> Online
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appSection" class="hidden">
        <header class="app-header">
            <div class="container header-content">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <img id="headerLogo" class="store-logo" src="" alt="Store Logo">
                    <h1 id="headerStoreName">Offline POS System</h1>
                </div>
                <div class="user-info">
                    <span id="userName">Manager</span>
                    <span id="userRole">(Manager)</span>
                    <button id="logoutButton" class="btn btn-secondary">Logout</button>
                </div>
            </div>
        </header>

        <nav class="app-nav">
            <div class="container">
                <ul class="nav-tabs">
                    <li class="nav-tab active" data-tab="pos">POS Terminal</li>
                    <li class="nav-tab" data-tab="manager">Manager App</li>
                    <li class="nav-tab" data-tab="settings">Settings</li>
                </ul>
            </div>
        </nav>

        <main class="container">
            <!-- POS Terminal -->
            <div id="posTab" class="tab-content">
                <div class="pos-container">
                    <div class="products-section">
                        <h2>Products</h2>
                        <div class="search-container">
                            <input type="text" id="productSearch" class="search-box" placeholder="Search by name or barcode...">
                        </div>

                        <!-- Category Filter -->
                        <div class="category-filter" id="categoryFilter">
                            <button class="category-btn active" data-category="all">All</button>
                            <!-- Categories will be dynamically added here -->
                        </div>

                        <div class="quick-access" id="quickAccess">
                            <!-- Quick access products will be dynamically added here -->
                        </div>

                        <!-- Featured Products -->
                        <div class="featured-products">
                            <h3>Featured Products</h3>
                            <div class="featured-grid" id="featuredProducts">
                                <!-- Featured products will be dynamically added here -->
                            </div>
                        </div>

                        <div class="products-grid" id="productsGrid">
                            <!-- Products will be dynamically added here -->
                        </div>
                    </div>
                    <div class="cart-container">
                        <h2>Current Sale</h2>

                        <!-- Customer Information -->
                        <div class="customer-section">
                            <div class="customer-input">
                                <input type="text" id="customerName" placeholder="Customer Name">
                                <button class="btn btn-secondary" id="addCustomer">Add</button>
                            </div>
                            <div class="customer-info hidden" id="customerInfo">
                                Customer: <span id="customerNameDisplay"></span>
                            </div>
                            <div class="loyalty-points hidden" id="loyaltyPoints">
                                Loyalty Points: <span id="pointsCount">0</span>
                            </div>
                        </div>

                        <div class="cart-items" id="cartItems">
                            <!-- Cart items will be dynamically added here -->
                        </div>

                        <!-- Discount Section -->
                        <div class="discount-section">
                            <div class="discount-input">
                                <input type="number" id="discountAmount" placeholder="Discount Amount" min="0">
                                <button class="btn btn-secondary" id="applyDiscount">Apply</button>
                            </div>
                            <div class="change-display hidden" id="discountDisplay">
                                Discount: TSh <span id="discountValue">0.00</span>
                            </div>
                        </div>

                        <div class="cart-total">
                            Subtotal: TSh <span id="cartSubtotal">0.00</span><br>
                            <div id="discountLine" class="hidden">Discount: -TSh <span id="discountTotal">0.00</span></div>
                            Total: TSh <span id="cartTotal">0.00</span>
                        </div>

                        <div class="payment-section">
                            <div class="payment-input">
                                <input type="number" id="amountReceived" placeholder="Amount Received" min="0">
                                <button class="btn btn-primary" id="calculateChange">Calculate</button>
                            </div>
                            <div class="change-display hidden" id="changeDisplay">
                                Change: TSh <span id="changeAmount">0.00</span>
                            </div>
                        </div>

                        <div class="payment-actions">
                            <button class="btn btn-success" id="processPayment">Process Payment</button>
                            <button class="btn btn-danger" id="clearCart">Clear Cart</button>
                            <button class="btn btn-warning" id="saveSale">Save Sale</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manager App -->
            <div id="managerTab" class="tab-content hidden">
                <div class="manager-container">
                    <div class="manager-sidebar">
                        <ul class="manager-menu">
                            <li class="manager-menu-item active" data-manager-tab="dashboard">Dashboard</li>
                            <li class="manager-menu-item" data-manager-tab="products">Product Management</li>
                            <li class="manager-menu-item" data-manager-tab="quickAccess">Quick Access Setup</li>
                            <li class="manager-menu-item" data-manager-tab="terminals">Terminal Management</li>
                            <li class="manager-menu-item" data-manager-tab="reports">Sales Reports</li>
                            <li class="manager-menu-item" data-manager-tab="inventory">Inventory Management</li>
                            <li class="manager-menu-item" data-manager-tab="customers">Customer Management</li>
                        </ul>
                    </div>
                    <div class="manager-content">
                        <!-- Dashboard -->
                        <div id="managerDashboard" class="manager-tab-content">
                            <h2>Dashboard</h2>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-label">Today's Sales</div>
                                    <div class="stat-value" id="todaySales">TSh 0.00</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Active Terminals</div>
                                    <div class="stat-value" id="activeTerminals">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Total Products</div>
                                    <div class="stat-value" id="totalProducts">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Transactions Today</div>
                                    <div class="stat-value" id="transactionsToday">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Low Stock Items</div>
                                    <div class="stat-value" id="lowStockItems">0</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">Total Customers</div>
                                    <div class="stat-value" id="totalCustomers">0</div>
                                </div>
                            </div>

                            <!-- Sales Chart Placeholder -->
                            <div class="chart-container">
                                <h3>Sales Overview</h3>
                                <div class="chart-placeholder">
                                    Sales Chart (Visualization would appear here in a real application)
                                </div>
                            </div>

                            <h3>Recent Transactions</h3>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Time</th>
                                            <th>Amount</th>
                                            <th>Terminal</th>
                                            <th>Customer</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentTransactions">
                                        <!-- Recent transactions will be added here -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- Inventory Alerts -->
                            <div class="inventory-alert" id="inventoryAlert">
                                <h3>Inventory Alerts</h3>
                                <div id="inventoryAlertList">
                                    <!-- Low stock alerts will be added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Product Management -->
                        <div id="managerProducts" class="manager-tab-content hidden">
                            <h2>Product Management</h2>
                            <button class="btn btn-primary" id="addProductBtn">Add Product</button>
                            <button class="btn btn-secondary" id="importProducts">Import Products</button>
                            <button class="btn btn-secondary" id="exportProducts">Export Products</button>

                            <div class="search-container" style="margin-top: 15px;">
                                <input type="text" id="productManagementSearch" class="search-box" placeholder="Search products...">
                            </div>

                            <div class="table-container" style="margin-top: 20px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Barcode</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Category</th>
                                            <th>Featured</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsTable">
                                        <!-- Products will be added here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Quick Access Setup -->
                        <div id="managerQuickAccess" class="manager-tab-content hidden">
                            <h2>Quick Access Products</h2>
                            <p>Click the buttons below to add or remove products from the quick access bar in the POS.</p>
                            <div class="products-grid" id="quickAccessSetup">
                                <!-- Products for quick access setup will be added here -->
                            </div>
                        </div>

                        <!-- Terminal Management -->
                        <div id="managerTerminals" class="manager-tab-content hidden">
                            <h2>Terminal Management</h2>
                            <button class="btn btn-primary" id="addTerminalBtn">Add Terminal</button>
                            <ul class="terminal-list" id="terminalsList">
                                <!-- Terminals will be added here -->
                            </ul>
                        </div>

                        <!-- Sales Reports -->
                        <div id="managerReports" class="manager-tab-content hidden">
                            <h2>Sales Reports</h2>
                            <div class="form-group">
                                <label for="reportPeriod">Report Period</label>
                                <select id="reportPeriod" class="form-control">
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div id="customDateRange" class="hidden">
                                <div class="form-group">
                                    <label for="startDate">Start Date</label>
                                    <input type="date" id="startDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="endDate">End Date</label>
                                    <input type="date" id="endDate" class="form-control">
                                </div>
                            </div>

                            <div class="export-options">
                                <button class="btn btn-primary" id="generateReport">Generate Report</button>
                                <button class="btn btn-secondary" id="exportReport">Export as CSV</button>
                                <button class="btn btn-secondary" id="printReport">Print Report</button>
                            </div>

                            <div id="reportResults" style="margin-top: 20px;">
                                <!-- Report results will be displayed here -->
                            </div>
                        </div>

                        <!-- Inventory Management -->
                        <div id="managerInventory" class="manager-tab-content hidden">
                            <h2>Inventory Management</h2>
                            <button class="btn btn-primary" id="addStockBtn">Add Stock</button>
                            <button class="btn btn-secondary" id="exportInventory">Export Inventory</button>

                            <div class="search-container" style="margin-top: 15px;">
                                <input type="text" id="inventorySearch" class="search-box" placeholder="Search inventory...">
                            </div>

                            <div class="table-container" style="margin-top: 20px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Current Stock</th>
                                            <th>Min Stock Level</th>
                                            <th>Status</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryTable">
                                        <!-- Inventory items will be added here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Customer Management -->
                        <div id="managerCustomers" class="manager-tab-content hidden">
                            <h2>Customer Management</h2>
                            <button class="btn btn-primary" id="addCustomerBtn">Add Customer</button>
                            <button class="btn btn-secondary" id="importCustomers">Import Customers</button>

                            <div class="search-container" style="margin-top: 15px;">
                                <input type="text" id="customerSearch" class="search-box" placeholder="Search customers...">
                            </div>

                            <div class="table-container" style="margin-top: 20px;">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th>Loyalty Points</th>
                                            <th>Total Spent</th>
                                            <th>Last Purchase</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTable">
                                        <!-- Customers will be added here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div id="settingsTab" class="tab-content hidden">
                <h2>Settings</h2>

                <div class="form-group">
                    <label for="terminalId">Terminal ID</label>
                    <input type="text" id="terminalId" class="form-control" readonly>
                </div>

                <h3>Store Customization</h3>

                <div class="form-group">
                    <label for="storeName">Store Name</label>
                    <input type="text" id="storeName" class="form-control" placeholder="Enter store name">
                </div>

                <div class="form-group">
                    <label for="storeMotto">Store Motto</label>
                    <input type="text" id="storeMotto" class="form-control" placeholder="Enter store motto">
                </div>

                <div class="form-group">
                    <label for="storeLogo">Store Logo</label>
                    <input type="file" id="storeLogo" class="form-control" accept="image/*">
                    <small>Recommended size: 150x40 pixels</small>
                </div>

                <div class="form-group">
                    <label for="wallpaper">Wallpaper</label>
                    <input type="file" id="wallpaper" class="form-control" accept="image/*">
                    <small>Choose an image to set as background</small>
                </div>

                <div class="customization-preview">
                    <h4>Preview</h4>
                    <div class="preview-header">
                        <img id="previewLogo" class="preview-logo" src="" alt="Logo Preview">
                        <div>
                            <div id="previewStoreName">Store Name</div>
                            <div id="previewMotto" class="preview-motto">Store Motto</div>
                        </div>
                    </div>
                    <div id="previewWallpaper" class="wallpaper-preview"></div>
                </div>

                <button class="btn btn-primary" id="saveCustomization">Save Customization</button>

                <hr style="margin: 20px 0;">

                <h3>Business Settings</h3>

                <div class="form-group">
                    <label for="taxRate">Tax Rate (%)</label>
                    <input type="number" id="taxRate" class="form-control" value="18" min="0" max="100" step="0.1">
                </div>

                <div class="form-group">
                    <label for="currencySymbol">Currency Symbol</label>
                    <input type="text" id="currencySymbol" class="form-control" value="TSh" maxlength="5">
                </div>

                <div class="form-group">
                    <label for="lowStockThreshold">Low Stock Threshold</label>
                    <input type="number" id="lowStockThreshold" class="form-control" value="10" min="1">
                </div>

                <button class="btn btn-primary" id="saveBusinessSettings">Save Business Settings</button>

                <hr style="margin: 20px 0;">

                <div class="form-group">
                    <label for="syncStatus">Sync Status</label>
                    <div id="syncStatus" class="status-offline">Offline</div>
                </div>
                <button class="btn btn-primary" id="syncData">Sync Data</button>
                <button class="btn btn-danger" id="clearData">Clear All Data</button>
            </div>
        </main>
    </div>

    <!-- Add Product Modal -->
    <div id="productModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">Add Product</h2>
                <button class="close-modal" id="cancelProduct">&times;</button>
            </div>
            <form id="productForm">
                <div class="form-group">
                    <label for="productName">Product Name</label>
                    <input type="text" id="productName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productBarcode">Barcode</label>
                    <input type="text" id="productBarcode" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productPrice">Price (TSh)</label>
                    <input type="number" id="productPrice" class="form-control" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="productStock">Stock</label>
                    <input type="number" id="productStock" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="productMinStock">Minimum Stock Level</label>
                    <input type="number" id="productMinStock" class="form-control" value="5">
                </div>
                <div class="form-group">
                    <label for="productCategory">Category</label>
                    <input type="text" id="productCategory" class="form-control">
                </div>
                <div class="form-group">
                    <label for="productDescription">Description</label>
                    <textarea id="productDescription" class="form-control" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="productFeatured"> Featured Product
                    </label>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" id="cancelProductBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="customerModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="customerModalTitle">Add Customer</h2>
                <button class="close-modal" id="cancelCustomer">&times;</button>
            </div>
            <form id="customerForm">
                <div class="form-group">
                    <label for="customerNameModal">Customer Name</label>
                    <input type="text" id="customerNameModal" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="customerPhone">Phone</label>
                    <input type="text" id="customerPhone" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customerEmail">Email</label>
                    <input type="email" id="customerEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label for="customerAddress">Address</label>
                    <textarea id="customerAddress" class="form-control" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" id="cancelCustomerBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Stock Modal -->
    <div id="stockModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Stock</h2>
                <button class="close-modal" id="cancelStock">&times;</button>
            </div>
            <form id="stockForm">
                <div class="form-group">
                    <label for="stockProduct">Product</label>
                    <select id="stockProduct" class="form-control" required>
                        <!-- Products will be dynamically added here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="stockQuantity">Quantity to Add</label>
                    <input type="number" id="stockQuantity" class="form-control" min="1" required>
                </div>
                <div class="form-group">
                    <label for="stockReason">Reason</label>
                    <select id="stockReason" class="form-control">
                        <option value="restock">Restock</option>
                        <option value="return">Return</option>
                        <option value="adjustment">Adjustment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stockNotes">Notes</label>
                    <textarea id="stockNotes" class="form-control" rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Add Stock</button>
                    <button type="button" class="btn btn-secondary" id="cancelStockBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Receipt</h2>
                <button class="close-modal" id="closeReceipt">&times;</button>
            </div>
            <div class="receipt" id="receiptContent">
                <!-- Receipt content will be dynamically added here -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-primary" id="printReceipt">Print</button>
                <button class="btn btn-secondary" id="closeReceiptBtn">Close</button>
                <button class="btn btn-success" id="emailReceipt">Email Receipt</button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const state = {
            currentUser: null,
            users: [
                { username: 'cashier', password: 'cashier123', role: 'cashier', name: 'Cashier User' },
                { username: 'manager', password: 'manager123', role: 'manager', name: 'Manager User' },
                { username: 'admin', password: 'admin123', role: 'admin', name: 'Administrator' }
            ],
            products: [],
            cart: [],
            terminals: [],
            transactions: [],
            quickAccessProducts: [],
            featuredProducts: [],
            customers: [],
            currentTab: 'pos',
            currentManagerTab: 'dashboard',
            editingProduct: null,
            editingCustomer: null,
            currentCustomer: null,
            discount: 0,
            businessSettings: {
                taxRate: 18,
                currencySymbol: 'TSh',
                lowStockThreshold: 10
            },
            customization: {
                storeName: 'Offline POS System',
                storeMotto: '',
                logo: '',
                wallpaper: ''
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            setupEventListeners();

            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                state.currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showLogin();
            }
        });

        // Initialize app data
        function initializeApp() {
            // Load data from localStorage
            loadData();

            // Initialize with sample data if empty
            if (state.products.length === 0) {
                initializeSampleData();
            }

            // Generate terminal ID if not exists
            if (!localStorage.getItem('terminalId')) {
                localStorage.setItem('terminalId', 'TERM-' + Math.random().toString(36).substr(2, 5).toUpperCase());
            }

            document.getElementById('terminalId').value = localStorage.getItem('terminalId');

            // Apply customization
            applyCustomization();

            // Load business settings
            loadBusinessSettings();
        }

        // Load data from localStorage
        function loadData() {
            state.products = JSON.parse(localStorage.getItem('products') || '[]');
            state.terminals = JSON.parse(localStorage.getItem('terminals') || '[]');
            state.transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            state.quickAccessProducts = JSON.parse(localStorage.getItem('quickAccessProducts') || '[]');
            state.featuredProducts = JSON.parse(localStorage.getItem('featuredProducts') || '[]');
            state.customers = JSON.parse(localStorage.getItem('customers') || '[]');

            // Load customization
            const savedCustomization = localStorage.getItem('customization');
            if (savedCustomization) {
                state.customization = JSON.parse(savedCustomization);
            }
        }

        // Save data to localStorage
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Load business settings
        function loadBusinessSettings() {
            const savedSettings = localStorage.getItem('businessSettings');
            if (savedSettings) {
                state.businessSettings = JSON.parse(savedSettings);

                // Update form fields
                document.getElementById('taxRate').value = state.businessSettings.taxRate;
                document.getElementById('currencySymbol').value = state.businessSettings.currencySymbol;
                document.getElementById('lowStockThreshold').value = state.businessSettings.lowStockThreshold;
            }
        }

        // Save business settings
        function saveBusinessSettings() {
            state.businessSettings.taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            state.businessSettings.currencySymbol = document.getElementById('currencySymbol').value || 'TSh';
            state.businessSettings.lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value) || 10;

            saveData('businessSettings', state.businessSettings);
            alert('Business settings saved successfully!');
        }

        // Apply customization settings
        function applyCustomization() {
            // Update header
            document.getElementById('headerStoreName').textContent = state.customization.storeName;
            document.getElementById('headerLogo').src = state.customization.logo;

            // Update preview
            document.getElementById('previewStoreName').textContent = state.customization.storeName;
            document.getElementById('previewMotto').textContent = state.customization.storeMotto;
            document.getElementById('previewLogo').src = state.customization.logo;

            // Apply wallpaper
            if (state.customization.wallpaper) {
                document.body.style.setProperty('--wallpaper', `url(${state.customization.wallpaper})`);
                document.getElementById('previewWallpaper').style.backgroundImage = `url(${state.customization.wallpaper})`;
                
                // Calculate brightness and update text colors
                calculateWallpaperBrightness(state.customization.wallpaper);
            } else {
                document.body.style.setProperty('--wallpaper', 'none');
                document.getElementById('previewWallpaper').style.backgroundImage = 'none';
                
                // Reset to default colors
                resetTextColors();
            }

            // Update form fields
            document.getElementById('storeName').value = state.customization.storeName;
            document.getElementById('storeMotto').value = state.customization.storeMotto;

            // Update login screen
            document.getElementById('loginStoreName').textContent = state.customization.storeName;
        }

        // Calculate wallpaper brightness and update text colors
        function calculateWallpaperBrightness(wallpaperUrl) {
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = wallpaperUrl;
            
            img.onload = function() {
                // Create a canvas to analyze the image
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Calculate average brightness
                let totalBrightness = 0;
                for (let i = 0; i < data.length; i += 4) {
                    // Calculate brightness using weighted average
                    const brightness = (data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114);
                    totalBrightness += brightness;
                }
                
                const averageBrightness = totalBrightness / (data.length / 4);
                
                // Update text colors based on brightness
                updateTextColors(averageBrightness);
            };
            
            img.onerror = function() {
                // If image fails to load, use default colors
                resetTextColors();
            };
        }

        // Update text colors based on wallpaper brightness
        function updateTextColors(brightness) {
            // Brightness range: 0 (dark) to 255 (light)
            const threshold = 128;
            
            if (brightness < threshold) {
                // Dark wallpaper - use light text
                document.documentElement.style.setProperty('--text-color', '#ffffff');
                document.documentElement.style.setProperty('--card-bg', 'rgba(0, 0, 0, 0.7)');
            } else {
                // Light wallpaper - use dark text
                document.documentElement.style.setProperty('--text-color', '#2c3e50');
                document.documentElement.style.setProperty('--card-bg', 'rgba(255, 255, 255, 0.92)');
            }
        }

        // Reset text colors to default
        function resetTextColors() {
            document.documentElement.style.setProperty('--text-color', '#2c3e50');
            document.documentElement.style.setProperty('--card-bg', 'rgba(255, 255, 255, 0.92)');
        }

        // Initialize with sample data
        function initializeSampleData() {
            // Sample products with Tanzanian currency
            state.products = [
                { id: '1', name: 'Maize Flour', barcode: '123456', price: 2500, stock: 50, minStock: 5, category: 'Food', description: '1kg pack of maize flour', featured: true },
                { id: '2', name: 'Cooking Oil', barcode: '789012', price: 4500, stock: 30, minStock: 5, category: 'Food', description: '1L bottle of cooking oil', featured: true },
                { id: '3', name: 'Sugar', barcode: '345678', price: 2000, stock: 40, minStock: 5, category: 'Food', description: '1kg pack of sugar', featured: false },
                { id: '4', name: 'Rice', barcode: '901234', price: 3000, stock: 25, minStock: 5, category: 'Food', description: '1kg pack of rice', featured: false },
                { id: '5', name: 'Soap', barcode: '567890', price: 1500, stock: 60, minStock: 5, category: 'Personal Care', description: 'Bar of soap', featured: false },
                { id: '6', name: 'Toothpaste', barcode: '234567', price: 3500, stock: 35, minStock: 5, category: 'Personal Care', description: 'Tube of toothpaste', featured: false },
                { id: '7', name: 'Biscuits', barcode: '890123', price: 1200, stock: 80, minStock: 5, category: 'Snacks', description: 'Packet of biscuits', featured: true },
                { id: '8', name: 'Soda', barcode: '456789', price: 1500, stock: 100, minStock: 5, category: 'Beverages', description: '500ml bottle of soda', featured: true }
            ];

            // Sample terminals
            state.terminals = [
                { id: 'TERM-001', name: 'Main Counter', status: 'online', lastActive: new Date().toISOString() },
                { id: 'TERM-002', name: 'Backup Terminal', status: 'offline', lastActive: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString() }
            ];

            // Sample transactions
            state.transactions = [
                { id: 'TXN-001', terminalId: 'TERM-001', amount: 8500, items: 3, timestamp: new Date().toISOString(), customer: null },
                { id: 'TXN-002', terminalId: 'TERM-001', amount: 6000, items: 2, timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), customer: null }
            ];

            // Sample customers
            state.customers = [
                { id: 'CUST-001', name: 'John Doe', phone: '+255123456789', email: 'john@example.com', address: 'Dar es Salaam', loyaltyPoints: 150, totalSpent: 45000, lastPurchase: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString() },
                { id: 'CUST-002', name: 'Jane Smith', phone: '+255987654321', email: 'jane@example.com', address: 'Arusha', loyaltyPoints: 75, totalSpent: 22500, lastPurchase: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString() }
            ];

            // Default quick access products (first 4 products)
            state.quickAccessProducts = state.products.slice(0, 4).map(p => p.id);

            // Default featured products
            state.featuredProducts = state.products.filter(p => p.featured).map(p => p.id);

            // Save sample data
            saveData('products', state.products);
            saveData('terminals', state.terminals);
            saveData('transactions', state.transactions);
            saveData('quickAccessProducts', state.quickAccessProducts);
            saveData('featuredProducts', state.featuredProducts);
            saveData('customers', state.customers);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login functionality
            document.querySelectorAll('.user-option').forEach(option => {
                option.addEventListener('click', function () {
                    // Remove selected class from all options
                    document.querySelectorAll('.user-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });

                    // Add selected class to clicked option
                    this.classList.add('selected');

                    // Check the radio button
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                });
            });

            document.getElementById('loginForm').addEventListener('submit', function (e) {
                e.preventDefault();
                handleLogin();
            });

            // Navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    switchTab(this.dataset.tab);
                });
            });

            // Manager navigation
            document.querySelectorAll('.manager-menu-item').forEach(item => {
                item.addEventListener('click', function () {
                    switchManagerTab(this.dataset.managerTab);
                });
            });

            // POS functionality
            document.getElementById('processPayment').addEventListener('click', processPayment);
            document.getElementById('clearCart').addEventListener('click', clearCart);
            document.getElementById('productSearch').addEventListener('input', searchProducts);
            document.getElementById('calculateChange').addEventListener('click', calculateChange);
            document.getElementById('amountReceived').addEventListener('keyup', function (e) {
                if (e.key === 'Enter') calculateChange();
            });
            document.getElementById('saveSale').addEventListener('click', saveSale);
            document.getElementById('applyDiscount').addEventListener('click', applyDiscount);
            document.getElementById('addCustomer').addEventListener('click', addCustomerToSale);

            // Manager functionality
            document.getElementById('addProductBtn').addEventListener('click', showAddProductModal);
            document.getElementById('cancelProduct').addEventListener('click', hideProductModal);
            document.getElementById('cancelProductBtn').addEventListener('click', hideProductModal);
            document.getElementById('productForm').addEventListener('submit', saveProduct);
            document.getElementById('addTerminalBtn').addEventListener('click', addTerminal);
            document.getElementById('generateReport').addEventListener('click', generateReport);
            document.getElementById('reportPeriod').addEventListener('change', toggleCustomDateRange);
            document.getElementById('exportReport').addEventListener('click', exportReport);
            document.getElementById('printReport').addEventListener('click', printReport);
            document.getElementById('importProducts').addEventListener('click', importProducts);
            document.getElementById('exportProducts').addEventListener('click', exportProducts);
            document.getElementById('productManagementSearch').addEventListener('input', filterProductsTable);

            // Customer management
            document.getElementById('addCustomerBtn').addEventListener('click', showAddCustomerModal);
            document.getElementById('cancelCustomer').addEventListener('click', hideCustomerModal);
            document.getElementById('cancelCustomerBtn').addEventListener('click', hideCustomerModal);
            document.getElementById('customerForm').addEventListener('submit', saveCustomer);
            document.getElementById('customerSearch').addEventListener('input', filterCustomersTable);
            document.getElementById('importCustomers').addEventListener('click', importCustomers);

            // Inventory management
            document.getElementById('addStockBtn').addEventListener('click', showAddStockModal);
            document.getElementById('cancelStock').addEventListener('click', hideStockModal);
            document.getElementById('cancelStockBtn').addEventListener('click', hideStockModal);
            document.getElementById('stockForm').addEventListener('submit', addStock);
            document.getElementById('inventorySearch').addEventListener('input', filterInventoryTable);
            document.getElementById('exportInventory').addEventListener('click', exportInventory);

            // Receipt functionality
            document.getElementById('printReceipt').addEventListener('click', printReceipt);
            document.getElementById('closeReceipt').addEventListener('click', hideReceipt);
            document.getElementById('closeReceiptBtn').addEventListener('click', hideReceipt);
            document.getElementById('emailReceipt').addEventListener('click', emailReceipt);

            // Settings
            document.getElementById('syncData').addEventListener('click', syncData);
            document.getElementById('clearData').addEventListener('click', clearAllData);
            document.getElementById('saveCustomization').addEventListener('click', saveCustomization);
            document.getElementById('saveBusinessSettings').addEventListener('click', saveBusinessSettings);
            document.getElementById('logoutButton').addEventListener('click', logout);

            // Customization preview
            document.getElementById('storeName').addEventListener('input', updatePreview);
            document.getElementById('storeMotto').addEventListener('input', updatePreview);
            document.getElementById('storeLogo').addEventListener('change', handleLogoUpload);
            document.getElementById('wallpaper').addEventListener('change', handleWallpaperUpload);
        }

        // Login functions
        function showLogin() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('appSection').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('appSection').classList.remove('hidden');
            updateUserInfo();
            applyRoleBasedAccess();
            renderPOS();
            updateManagerDashboard();
        }

        function handleLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = document.querySelector('input[name="userType"]:checked');

            // Reset error message
            document.getElementById('errorMessage').classList.add('hidden');

            // Validate inputs
            if (!username || !password || !userType) {
                showError('Please fill in all fields and select a user role');
                return;
            }

            // Find user
            const user = state.users.find(u =>
                u.username === username &&
                u.password === password &&
                u.role === userType.value
            );

            if (user) {
                // Successful login
                state.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showApp();
            } else {
                showError('Invalid credentials or user role mismatch');
            }
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function logout() {
            state.currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginForm').reset();
            document.querySelectorAll('.user-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            showLogin();
        }

        function updateUserInfo() {
            if (state.currentUser) {
                document.getElementById('userName').textContent = state.currentUser.name;
                document.getElementById('userRole').textContent = `(${state.currentUser.role})`;
            }
        }

        function applyRoleBasedAccess() {
            // Hide/show tabs based on user role
            const tabs = document.querySelectorAll('.nav-tab');

            tabs.forEach(tab => {
                const tabName = tab.dataset.tab;

                if (state.currentUser.role === 'cashier' && tabName !== 'pos') {
                    tab.style.display = 'none';
                } else if (state.currentUser.role === 'manager' && tabName === 'settings') {
                    tab.style.display = 'none';
                } else if (state.currentUser.role === 'admin' && tabName !== 'settings') {
                    tab.style.display = 'none';
                } else {
                    tab.style.display = 'block';
                }
            });

            // Set active tab based on role
            if (state.currentUser.role === 'cashier') {
                switchTab('pos');
            } else if (state.currentUser.role === 'manager') {
                switchTab('manager');
            } else if (state.currentUser.role === 'admin') {
                switchTab('settings');
            }
        }

        // Tab navigation
        function switchTab(tabName) {
            // Update tab UI
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Show selected tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.classList.remove('hidden');
            }

            state.currentTab = tabName;

            // Refresh content if needed
            if (tabName === 'manager') {
                updateManagerDashboard();
            } else if (tabName === 'pos') {
                renderPOS();
            }
        }

        function switchManagerTab(tabName) {
            // Update tab UI
            document.querySelectorAll('.manager-menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-manager-tab="${tabName}"]`).classList.add('active');

            // Show selected tab content
            document.querySelectorAll('.manager-tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            const tabElement = document.getElementById('manager' + tabName.charAt(0).toUpperCase() + tabName.slice(1));
            if (tabElement) {
                tabElement.classList.remove('hidden');
            }

            state.currentManagerTab = tabName;

            // Refresh content if needed
            if (tabName === 'products') {
                renderProductsTable();
            } else if (tabName === 'terminals') {
                renderTerminalsList();
            } else if (tabName === 'quickAccess') {
                renderQuickAccessSetup();
            } else if (tabName === 'inventory') {
                renderInventoryTable();
            } else if (tabName === 'customers') {
                renderCustomersTable();
            }
        }

        // POS Functions
        function renderPOS() {
            renderCategories();
            renderQuickAccess();
            renderFeaturedProducts();
            renderProducts();
            renderCart();
        }

        function renderCategories() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<button class="category-btn active" data-category="all">All</button>';

            // Get unique categories
            const categories = [...new Set(state.products.map(p => p.category).filter(Boolean))];

            categories.forEach(category => {
                const categoryBtn = document.createElement('button');
                categoryBtn.className = 'category-btn';
                categoryBtn.textContent = category;
                categoryBtn.dataset.category = category;
                categoryBtn.addEventListener('click', function () {
                    // Remove active class from all buttons
                    document.querySelectorAll('.category-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    // Add active class to clicked button
                    this.classList.add('active');
                    // Filter products
                    filterProductsByCategory(this.dataset.category);
                });
                categoryFilter.appendChild(categoryBtn);
            });
        }

        function filterProductsByCategory(category) {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';

            let filteredProducts = state.products;
            if (category !== 'all') {
                filteredProducts = state.products.filter(product => product.category === category);
            }

            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px;">No products found</div>';
                return;
            }

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                if (product.stock < state.businessSettings.lowStockThreshold) {
                    productCard.classList.add('low-stock');
                }
                if (product.stock === 0) {
                    productCard.classList.add('out-of-stock');
                }
                productCard.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${state.businessSettings.currencySymbol} ${product.price.toLocaleString()}</div>
                    <div class="product-stock">Stock: ${product.stock}</div>
                `;
                if (product.stock > 0) {
                    productCard.addEventListener('click', () => addToCart(product));
                }
                productsGrid.appendChild(productCard);
            });
        }

        function renderQuickAccess() {
            const quickAccess = document.getElementById('quickAccess');
            quickAccess.innerHTML = '';

            state.quickAccessProducts.forEach(productId => {
                const product = state.products.find(p => p.id === productId);
                if (product && product.stock > 0) {
                    const quickAccessItem = document.createElement('div');
                    quickAccessItem.className = 'quick-access-item';
                    quickAccessItem.innerHTML = `
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${state.businessSettings.currencySymbol} ${product.price.toLocaleString()}</div>
                    `;
                    quickAccessItem.addEventListener('click', () => addToCart(product));
                    quickAccess.appendChild(quickAccessItem);
                }
            });
        }

        function renderFeaturedProducts() {
            const featuredProducts = document.getElementById('featuredProducts');
            featuredProducts.innerHTML = '';

            state.featuredProducts.forEach(productId => {
                const product = state.products.find(p => p.id === productId);
                if (product && product.stock > 0) {
                    const featuredCard = document.createElement('div');
                    featuredCard.className = 'featured-card';
                    featuredCard.innerHTML = `
                        <div class="featured-badge">Featured</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">${state.businessSettings.currencySymbol} ${product.price.toLocaleString()}</div>
                        <div class="product-stock">Stock: ${product.stock}</div>
                    `;
                    featuredCard.addEventListener('click', () => addToCart(product));
                    featuredProducts.appendChild(featuredCard);
                }
            });
        }

        function renderProducts() {
            filterProductsByCategory('all');
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';

            const filteredProducts = state.products.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                (product.barcode && product.barcode.includes(searchTerm))
            );

            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 20px;">No products found</div>';
                return;
            }

            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                if (product.stock < state.businessSettings.lowStockThreshold) {
                    productCard.classList.add('low-stock');
                }
                if (product.stock === 0) {
                    productCard.classList.add('out-of-stock');
                }
                productCard.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${state.businessSettings.currencySymbol} ${product.price.toLocaleString()}</div>
                    <div class="product-stock">Stock: ${product.stock}</div>
                `;
                if (product.stock > 0) {
                    productCard.addEventListener('click', () => addToCart(product));
                }
                productsGrid.appendChild(productCard);
            });
        }

        function addToCart(product) {
            // Check if product is already in cart
            const existingItem = state.cart.find(item => item.product.id === product.id);

            if (existingItem) {
                if (existingItem.quantity < product.stock) {
                    existingItem.quantity++;
                } else {
                    alert('Not enough stock available');
                    return;
                }
            } else {
                if (product.stock > 0) {
                    state.cart.push({
                        product: product,
                        quantity: 1
                    });
                } else {
                    alert('Product out of stock');
                    return;
                }
            }

            renderCart();
        }

        function renderCart() {
            const cartItems = document.getElementById('cartItems');
            const cartSubtotal = document.getElementById('cartSubtotal');
            const cartTotal = document.getElementById('cartTotal');
            const discountLine = document.getElementById('discountLine');
            const discountTotal = document.getElementById('discountTotal');

            cartItems.innerHTML = '';
            let subtotal = 0;

            state.cart.forEach((item, index) => {
                const itemTotal = item.product.price * item.quantity;
                subtotal += itemTotal;

                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.product.name}</div>
                        <div class="cart-item-price">${state.businessSettings.currencySymbol} ${item.product.price.toLocaleString()} x ${item.quantity}</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="btn btn-secondary btn-sm decrease-btn">-</button>
                        <span>${item.quantity}</span>
                        <button class="btn btn-secondary btn-sm increase-btn">+</button>
                        <button class="btn btn-danger btn-sm remove-btn">Remove</button>
                    </div>
                `;

                // Add event listeners
                cartItem.querySelector('.decrease-btn').addEventListener('click', () => {
                    if (item.quantity > 1) {
                        item.quantity--;
                    } else {
                        state.cart.splice(index, 1);
                    }
                    renderCart();
                });

                cartItem.querySelector('.increase-btn').addEventListener('click', () => {
                    if (item.quantity < item.product.stock) {
                        item.quantity++;
                        renderCart();
                    } else {
                        alert('Not enough stock available');
                    }
                });

                cartItem.querySelector('.remove-btn').addEventListener('click', () => {
                    state.cart.splice(index, 1);
                    renderCart();
                });

                cartItems.appendChild(cartItem);
            });

            cartSubtotal.textContent = subtotal.toLocaleString();

            // Calculate total with discount
            const total = subtotal - state.discount;
            cartTotal.textContent = total.toLocaleString();

            // Show/hide discount line
            if (state.discount > 0) {
                discountLine.classList.remove('hidden');
                discountTotal.textContent = state.discount.toLocaleString();
            } else {
                discountLine.classList.add('hidden');
            }

            // Reset change calculation
            document.getElementById('amountReceived').value = '';
            document.getElementById('changeDisplay').classList.add('hidden');
        }

        function clearCart() {
            state.cart = [];
            state.discount = 0;
            state.currentCustomer = null;
            document.getElementById('customerInfo').classList.add('hidden');
            document.getElementById('loyaltyPoints').classList.add('hidden');
            document.getElementById('customerName').value = '';
            document.getElementById('discountAmount').value = '';
            document.getElementById('discountDisplay').classList.add('hidden');
            renderCart();
        }

        function applyDiscount() {
            const discountAmount = parseFloat(document.getElementById('discountAmount').value);

            if (isNaN(discountAmount) || discountAmount < 0) {
                alert('Please enter a valid discount amount');
                return;
            }

            const subtotal = parseFloat(document.getElementById('cartSubtotal').textContent.replace(/,/g, ''));

            if (discountAmount > subtotal) {
                alert('Discount cannot be greater than subtotal');
                return;
            }

            state.discount = discountAmount;
            document.getElementById('discountValue').textContent = discountAmount.toLocaleString();
            document.getElementById('discountDisplay').classList.remove('hidden');
            renderCart();
        }

        function addCustomerToSale() {
            const customerName = document.getElementById('customerName').value.trim();

            if (!customerName) {
                alert('Please enter a customer name');
                return;
            }

            // Check if customer exists
            let customer = state.customers.find(c => c.name.toLowerCase() === customerName.toLowerCase());

            if (!customer) {
                // Create new customer
                customer = {
                    id: 'CUST-' + Date.now(),
                    name: customerName,
                    phone: '',
                    email: '',
                    address: '',
                    loyaltyPoints: 0,
                    totalSpent: 0,
                    lastPurchase: new Date().toISOString()
                };
                state.customers.push(customer);
                saveData('customers', state.customers);
            }

            state.currentCustomer = customer;
            document.getElementById('customerNameDisplay').textContent = customer.name;
            document.getElementById('customerInfo').classList.remove('hidden');
            document.getElementById('pointsCount').textContent = customer.loyaltyPoints;
            document.getElementById('loyaltyPoints').classList.remove('hidden');
        }

        function calculateChange() {
            const amountReceived = parseFloat(document.getElementById('amountReceived').value);
            const total = parseFloat(document.getElementById('cartTotal').textContent.replace(/,/g, ''));

            if (isNaN(amountReceived) || amountReceived < 0) {
                alert('Please enter a valid amount');
                return;
            }

            if (amountReceived < total) {
                alert('Amount received is less than total amount');
                return;
            }

            const change = amountReceived - total;
            document.getElementById('changeAmount').textContent = change.toLocaleString();
            document.getElementById('changeDisplay').classList.remove('hidden');
        }

        function processPayment() {
            if (state.cart.length === 0) {
                alert('Cart is empty');
                return;
            }

            const amountReceived = parseFloat(document.getElementById('amountReceived').value);
            const total = parseFloat(document.getElementById('cartTotal').textContent.replace(/,/g, ''));

            if (isNaN(amountReceived) || amountReceived < total) {
                alert('Please enter valid payment amount');
                return;
            }

            // Create transaction
            const transaction = {
                id: 'TXN-' + Date.now(),
                terminalId: localStorage.getItem('terminalId'),
                amount: total,
                items: state.cart.reduce((total, item) => total + item.quantity, 0),
                timestamp: new Date().toISOString(),
                cart: [...state.cart],
                amountReceived: amountReceived,
                change: amountReceived - total,
                discount: state.discount,
                customer: state.currentCustomer
            };

            // Update product stock
            state.cart.forEach(cartItem => {
                const product = state.products.find(p => p.id === cartItem.product.id);
                if (product) {
                    product.stock -= cartItem.quantity;
                }
            });

            // Update customer loyalty points and spending
            if (state.currentCustomer) {
                const customer = state.customers.find(c => c.id === state.currentCustomer.id);
                if (customer) {
                    // 1 point per 1000 TSh spent
                    const pointsEarned = Math.floor(total / 1000);
                    customer.loyaltyPoints += pointsEarned;
                    customer.totalSpent += total;
                    customer.lastPurchase = new Date().toISOString();
                }
            }

            // Save data
            state.transactions.push(transaction);
            saveData('transactions', state.transactions);
            saveData('products', state.products);
            saveData('customers', state.customers);

            // Update terminal last active
            const terminal = state.terminals.find(t => t.id === transaction.terminalId);
            if (terminal) {
                terminal.lastActive = new Date().toISOString();
                terminal.status = 'online';
                saveData('terminals', state.terminals);
            }

            // Generate and show receipt
            generateReceipt(transaction);

            // Clear cart and refresh
            clearCart();
            renderProducts();

            // Update dashboard if visible
            if (state.currentTab === 'manager') {
                updateManagerDashboard();
            }
        }

        function saveSale() {
            if (state.cart.length === 0) {
                alert('Cart is empty');
                return;
            }

            // Create saved sale
            const savedSale = {
                id: 'SALE-' + Date.now(),
                timestamp: new Date().toISOString(),
                cart: [...state.cart],
                discount: state.discount,
                customer: state.currentCustomer
            };

            // Save to localStorage
            let savedSales = JSON.parse(localStorage.getItem('savedSales') || '[]');
            savedSales.push(savedSale);
            saveData('savedSales', savedSales);

            alert('Sale saved successfully!');
        }

        function generateReceipt(transaction) {
            const receiptContent = document.getElementById('receiptContent');
            let receiptHTML = `
                <div class="receipt-header">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                        ${state.customization.logo ? `<img src="${state.customization.logo}" style="max-height: 40px; max-width: 100px;">` : ''}
                        <h3>${state.customization.storeName}</h3>
                    </div>
                    ${state.customization.storeMotto ? `<p>${state.customization.storeMotto}</p>` : ''}
                    <p>Receipt #${transaction.id}</p>
                    <p>${new Date(transaction.timestamp).toLocaleString()}</p>
                </div>
                <div class="receipt-items">
            `;

            transaction.cart.forEach(item => {
                receiptHTML += `
                    <div class="receipt-item">
                        <span>${item.product.name} x ${item.quantity}</span>
                        <span>${state.businessSettings.currencySymbol} ${(item.product.price * item.quantity).toLocaleString()}</span>
                    </div>
                `;
            });

            receiptHTML += `
                </div>
                <div class="receipt-total">
                    <div class="receipt-item">
                        <span>Subtotal:</span>
                        <span>${state.businessSettings.currencySymbol} ${(transaction.amount + transaction.discount).toLocaleString()}</span>
                    </div>
            `;

            if (transaction.discount > 0) {
                receiptHTML += `
                    <div class="receipt-item">
                        <span>Discount:</span>
                        <span>-${state.businessSettings.currencySymbol} ${transaction.discount.toLocaleString()}</span>
                    </div>
                `;
            }

            receiptHTML += `
                    <div class="receipt-item">
                        <span>Total:</span>
                        <span>${state.businessSettings.currencySymbol} ${transaction.amount.toLocaleString()}</span>
                    </div>
                    <div class="receipt-item">
                        <span>Amount Received:</span>
                        <span>${state.businessSettings.currencySymbol} ${transaction.amountReceived.toLocaleString()}</span>
                    </div>
                    <div class="receipt-item">
                        <span>Change:</span>
                        <span>${state.businessSettings.currencySymbol} ${transaction.change.toLocaleString()}</span>
                    </div>
                </div>
            `;

            if (transaction.customer) {
                receiptHTML += `
                    <div style="margin-top: 10px;">
                        <p>Customer: ${transaction.customer.name}</p>
                        <p>Loyalty Points Earned: ${Math.floor(transaction.amount / 1000)}</p>
                    </div>
                `;
            }

            receiptHTML += `
                <div class="receipt-footer">
                    <p>Thank you for your purchase!</p>
                </div>
            `;

            receiptContent.innerHTML = receiptHTML;
            document.getElementById('receiptModal').classList.remove('hidden');
        }

        function printReceipt() {
            window.print();
        }

        function emailReceipt() {
            alert('In a real application, this would email the receipt to the customer');
        }

        function hideReceipt() {
            document.getElementById('receiptModal').classList.add('hidden');
        }

        // Manager Functions
        function updateManagerDashboard() {
            // Today's sales
            const today = new Date().toDateString();
            const todaySales = state.transactions
                .filter(t => new Date(t.timestamp).toDateString() === today)
                .reduce((total, t) => total + t.amount, 0);
            document.getElementById('todaySales').textContent = state.businessSettings.currencySymbol + ' ' + todaySales.toLocaleString();

            // Active terminals
            const activeTerminals = state.terminals.filter(t => t.status === 'online').length;
            document.getElementById('activeTerminals').textContent = activeTerminals;

            // Total products
            document.getElementById('totalProducts').textContent = state.products.length;

            // Transactions today
            const transactionsToday = state.transactions
                .filter(t => new Date(t.timestamp).toDateString() === today)
                .length;
            document.getElementById('transactionsToday').textContent = transactionsToday;

            // Low stock items
            const lowStockItems = state.products.filter(p => p.stock < state.businessSettings.lowStockThreshold).length;
            document.getElementById('lowStockItems').textContent = lowStockItems;

            // Total customers
            document.getElementById('totalCustomers').textContent = state.customers.length;

            // Recent transactions
            const recentTransactions = document.getElementById('recentTransactions');
            recentTransactions.innerHTML = '';

            const sortedTransactions = state.transactions
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 5);

            sortedTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${transaction.id}</td>
                    <td>${new Date(transaction.timestamp).toLocaleString()}</td>
                    <td>${state.businessSettings.currencySymbol} ${transaction.amount.toLocaleString()}</td>
                    <td>${transaction.terminalId}</td>
                    <td>${transaction.customer ? transaction.customer.name : 'Walk-in'}</td>
                `;
                recentTransactions.appendChild(row);
            });

            // Inventory alerts
            const inventoryAlertList = document.getElementById('inventoryAlertList');
            inventoryAlertList.innerHTML = '';

            const lowStockProducts = state.products.filter(p => p.stock < state.businessSettings.lowStockThreshold);

            if (lowStockProducts.length === 0) {
                inventoryAlertList.innerHTML = '<p>No inventory alerts</p>';
            } else {
                lowStockProducts.forEach(product => {
                    const alertItem = document.createElement('div');
                    alertItem.style.padding = '5px 0';
                    alertItem.innerHTML = `
                        <span class="inventory-warning">${product.name}</span> - Only ${product.stock} left in stock
                    `;
                    inventoryAlertList.appendChild(alertItem);
                });
            }
        }

        function renderProductsTable() {
            const productsTable = document.getElementById('productsTable');
            productsTable.innerHTML = '';

            state.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.barcode || 'N/A'}</td>
                    <td>${state.businessSettings.currencySymbol} ${product.price.toLocaleString()}</td>
                    <td>${product.stock}</td>
                    <td>${product.category || 'N/A'}</td>
                    <td>${product.featured ? 'Yes' : 'No'}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm edit-product" data-id="${product.id}">Edit</button>
                        <button class="btn btn-danger btn-sm delete-product" data-id="${product.id}">Delete</button>
                    </td>
                `;
                productsTable.appendChild(row);
            });

            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-product').forEach(button => {
                button.addEventListener('click', function () {
                    editProduct(this.dataset.id);
                });
            });

            document.querySelectorAll('.delete-product').forEach(button => {
                button.addEventListener('click', function () {
                    deleteProduct(this.dataset.id);
                });
            });
        }

        function filterProductsTable() {
            const searchTerm = document.getElementById('productManagementSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#productsTable tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function renderQuickAccessSetup() {
            const quickAccessSetup = document.getElementById('quickAccessSetup');
            quickAccessSetup.innerHTML = '';

            state.products.forEach(product => {
                const isInQuickAccess = state.quickAccessProducts.includes(product.id);
                const productCard = document.createElement('div');
                productCard.className = 'product-card quick-access-card'; // Added consistent class
                productCard.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${state.businessSettings.currencySymbol} ${product.price.toLocaleString()}</div>
                    <div class="product-stock">Stock: ${product.stock}</div>
                    <div style="margin-top: 10px;">
                        <button class="btn ${isInQuickAccess ? 'btn-warning' : 'btn-primary'} toggle-quick-access" data-id="${product.id}">
                            ${isInQuickAccess ? 'Remove from Quick Access' : 'Add to Quick Access'}
                        </button>
                    </div>
                `;
                quickAccessSetup.appendChild(productCard);
            });

            // Add event listeners for toggle buttons
            document.querySelectorAll('.toggle-quick-access').forEach(button => {
                button.addEventListener('click', function () {
                    toggleQuickAccess(this.dataset.id);
                });
            });
        }

        function toggleQuickAccess(productId) {
            const index = state.quickAccessProducts.indexOf(productId);

            if (index > -1) {
                // Remove from quick access
                state.quickAccessProducts.splice(index, 1);
            } else {
                // Add to quick access
                state.quickAccessProducts.push(productId);
            }

            saveData('quickAccessProducts', state.quickAccessProducts);
            renderQuickAccessSetup();
            renderQuickAccess(); // Update POS view
        }

        function showAddProductModal() {
            state.editingProduct = null;
            document.getElementById('productModalTitle').textContent = 'Add Product';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').classList.remove('hidden');
        }

        function hideProductModal() {
            document.getElementById('productModal').classList.add('hidden');
        }

        function editProduct(productId) {
            const product = state.products.find(p => p.id === productId);
            if (product) {
                state.editingProduct = product;
                document.getElementById('productModalTitle').textContent = 'Edit Product';
                document.getElementById('productName').value = product.name;
                document.getElementById('productBarcode').value = product.barcode || '';
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productMinStock').value = product.minStock || 5;
                document.getElementById('productCategory').value = product.category || '';
                document.getElementById('productDescription').value = product.description || '';
                document.getElementById('productFeatured').checked = product.featured || false;
                document.getElementById('productModal').classList.remove('hidden');
            }
        }

        function saveProduct(e) {
            e.preventDefault();

            const productData = {
                name: document.getElementById('productName').value,
                barcode: document.getElementById('productBarcode').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                minStock: parseInt(document.getElementById('productMinStock').value) || 5,
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value,
                featured: document.getElementById('productFeatured').checked
            };

            if (state.editingProduct) {
                // Update existing product
                Object.assign(state.editingProduct, productData);
            } else {
                // Add new product
                productData.id = Date.now().toString();
                state.products.push(productData);
            }

            // Update featured products list
            updateFeaturedProducts();

            saveData('products', state.products);
            hideProductModal();
            renderProductsTable();
            renderProducts(); // Update POS view
            renderQuickAccessSetup(); // Update quick access setup
            renderFeaturedProducts(); // Update featured products
        }

        function updateFeaturedProducts() {
            state.featuredProducts = state.products.filter(p => p.featured).map(p => p.id);
            saveData('featuredProducts', state.featuredProducts);
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                state.products = state.products.filter(p => p.id !== productId);

                // Remove from quick access if present
                const quickAccessIndex = state.quickAccessProducts.indexOf(productId);
                if (quickAccessIndex > -1) {
                    state.quickAccessProducts.splice(quickAccessIndex, 1);
                    saveData('quickAccessProducts', state.quickAccessProducts);
                }

                // Remove from featured if present
                const featuredIndex = state.featuredProducts.indexOf(productId);
                if (featuredIndex > -1) {
                    state.featuredProducts.splice(featuredIndex, 1);
                    saveData('featuredProducts', state.featuredProducts);
                }

                saveData('products', state.products);
                renderProductsTable();
                renderProducts(); // Update POS view
                renderQuickAccessSetup(); // Update quick access setup
                renderFeaturedProducts(); // Update featured products
            }
        }

        function importProducts() {
            alert('In a real application, this would allow importing products from a CSV file');
        }

        function exportProducts() {
            alert('In a real application, this would export products to a CSV file');
        }

        function renderTerminalsList() {
            const terminalsList = document.getElementById('terminalsList');
            terminalsList.innerHTML = '';

            state.terminals.forEach(terminal => {
                const terminalItem = document.createElement('li');
                terminalItem.className = 'terminal-item';
                terminalItem.innerHTML = `
                    <div class="terminal-info">
                        <div class="terminal-name">${terminal.name} (${terminal.id})</div>
                        <div class="terminal-status ${terminal.status}">Status: ${terminal.status}</div>
                        <div class="terminal-last-active">Last active: ${new Date(terminal.lastActive).toLocaleString()}</div>
                    </div>
                    <div class="terminal-actions">
                        <button class="btn btn-danger btn-sm remove-terminal" data-id="${terminal.id}">Remove</button>
                    </div>
                `;
                terminalsList.appendChild(terminalItem);
            });

            // Add event listeners for remove buttons
            document.querySelectorAll('.remove-terminal').forEach(button => {
                button.addEventListener('click', function () {
                    removeTerminal(this.dataset.id);
                });
            });
        }

        function addTerminal() {
            const terminalId = 'TERM-' + Math.random().toString(36).substr(2, 5).toUpperCase();
            const terminalName = prompt('Enter terminal name:');

            if (terminalName) {
                const newTerminal = {
                    id: terminalId,
                    name: terminalName,
                    status: 'offline',
                    lastActive: new Date().toISOString()
                };

                state.terminals.push(newTerminal);
                saveData('terminals', state.terminals);
                renderTerminalsList();
            }
        }

        function removeTerminal(terminalId) {
            if (confirm('Are you sure you want to remove this terminal?')) {
                state.terminals = state.terminals.filter(t => t.id !== terminalId);
                saveData('terminals', state.terminals);
                renderTerminalsList();
            }
        }

        function toggleCustomDateRange() {
            const period = document.getElementById('reportPeriod').value;
            document.getElementById('customDateRange').classList.toggle('hidden', period !== 'custom');
        }

        function generateReport() {
            const period = document.getElementById('reportPeriod').value;
            let startDate, endDate;

            const now = new Date();

            switch (period) {
                case 'today':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
                    break;
                case 'week':
                    const day = now.getDay();
                    startDate = new Date(now);
                    startDate.setDate(now.getDate() - day);
                    startDate.setHours(0, 0, 0, 0);
                    endDate = new Date(startDate);
                    endDate.setDate(startDate.getDate() + 6);
                    endDate.setHours(23, 59, 59, 999);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);
                    break;
                case 'custom':
                    startDate = new Date(document.getElementById('startDate').value);
                    endDate = new Date(document.getElementById('endDate').value);
                    endDate.setHours(23, 59, 59, 999);
                    break;
            }

            const filteredTransactions = state.transactions.filter(t => {
                const transactionDate = new Date(t.timestamp);
                return transactionDate >= startDate && transactionDate <= endDate;
            });

            const totalSales = filteredTransactions.reduce((sum, t) => sum + t.amount, 0);
            const transactionCount = filteredTransactions.length;
            const avgTransaction = transactionCount > 0 ? totalSales / transactionCount : 0;

            // Calculate sales by product
            const productSales = {};
            filteredTransactions.forEach(transaction => {
                transaction.cart.forEach(item => {
                    const productId = item.product.id;
                    if (!productSales[productId]) {
                        productSales[productId] = {
                            name: item.product.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productSales[productId].quantity += item.quantity;
                    productSales[productId].revenue += item.product.price * item.quantity;
                });
            });

            // Sort products by revenue
            const topProducts = Object.values(productSales)
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 5);

            const reportResults = document.getElementById('reportResults');
            reportResults.innerHTML = `
                <h3>Sales Report (${period})</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Sales</div>
                        <div class="stat-value">${state.businessSettings.currencySymbol} ${totalSales.toLocaleString()}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Transactions</div>
                        <div class="stat-value">${transactionCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Transaction</div>
                        <div class="stat-value">${state.businessSettings.currencySymbol} ${avgTransaction.toLocaleString()}</div>
                    </div>
                </div>
                
                <h4>Top Products</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity Sold</th>
                                <th>Revenue</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${topProducts.map(p => `
                                <tr>
                                    <td>${p.name}</td>
                                    <td>${p.quantity}</td>
                                    <td>${state.businessSettings.currencySymbol} ${p.revenue.toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <h4>Transaction Details</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Date/Time</th>
                                <th>Terminal</th>
                                <th>Amount</th>
                                <th>Items</th>
                                <th>Customer</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredTransactions.map(t => `
                                <tr>
                                    <td>${t.id}</td>
                                    <td>${new Date(t.timestamp).toLocaleString()}</td>
                                    <td>${t.terminalId}</td>
                                    <td>${state.businessSettings.currencySymbol} ${t.amount.toLocaleString()}</td>
                                    <td>${t.items}</td>
                                    <td>${t.customer ? t.customer.name : 'Walk-in'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function exportReport() {
            alert('In a real application, this would export the report as a CSV file');
        }

        function printReport() {
            const reportResults = document.getElementById('reportResults');
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Sales Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>Sales Report</h1>
                    ${reportResults.innerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Inventory Management Functions
        function renderInventoryTable() {
            const inventoryTable = document.getElementById('inventoryTable');
            inventoryTable.innerHTML = '';

            state.products.forEach(product => {
                let status = 'In Stock';
                let statusClass = '';

                if (product.stock === 0) {
                    status = 'Out of Stock';
                    statusClass = 'status-offline';
                } else if (product.stock < state.businessSettings.lowStockThreshold) {
                    status = 'Low Stock';
                    statusClass = 'status-warning';
                } else {
                    statusClass = 'status-online';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.stock}</td>
                    <td>${product.minStock || 5}</td>
                    <td class="${statusClass}">${status}</td>
                    <td>${new Date().toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm adjust-stock" data-id="${product.id}">Adjust</button>
                    </td>
                `;
                inventoryTable.appendChild(row);
            });

            // Add event listeners for adjust buttons
            document.querySelectorAll('.adjust-stock').forEach(button => {
                button.addEventListener('click', function () {
                    adjustStock(this.dataset.id);
                });
            });
        }

        function filterInventoryTable() {
            const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
            const rows = document.querySelectorAll('#inventoryTable tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function showAddStockModal() {
            document.getElementById('stockModal').classList.remove('hidden');
            populateStockProducts();
        }

        function hideStockModal() {
            document.getElementById('stockModal').classList.add('hidden');
        }

        function populateStockProducts() {
            const stockProduct = document.getElementById('stockProduct');
            stockProduct.innerHTML = '';

            state.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (Current: ${product.stock})`;
                stockProduct.appendChild(option);
            });
        }

        function addStock(e) {
            e.preventDefault();

            const productId = document.getElementById('stockProduct').value;
            const quantity = parseInt(document.getElementById('stockQuantity').value);
            const reason = document.getElementById('stockReason').value;
            const notes = document.getElementById('stockNotes').value;

            const product = state.products.find(p => p.id === productId);
            if (product) {
                product.stock += quantity;
                saveData('products', state.products);

                // Record stock adjustment
                const adjustment = {
                    id: 'ADJ-' + Date.now(),
                    productId: productId,
                    productName: product.name,
                    quantity: quantity,
                    reason: reason,
                    notes: notes,
                    timestamp: new Date().toISOString()
                };

                let stockAdjustments = JSON.parse(localStorage.getItem('stockAdjustments') || '[]');
                stockAdjustments.push(adjustment);
                saveData('stockAdjustments', stockAdjustments);

                alert(`Added ${quantity} units to ${product.name}. New stock: ${product.stock}`);
                hideStockModal();
                renderInventoryTable();
                renderProducts(); // Update POS view
            }
        }

        function adjustStock(productId) {
            const product = state.products.find(p => p.id === productId);
            if (product) {
                const newStock = prompt(`Enter new stock quantity for ${product.name}:`, product.stock);
                if (newStock !== null) {
                    const quantity = parseInt(newStock);
                    if (!isNaN(quantity) && quantity >= 0) {
                        const adjustment = quantity - product.stock;
                        product.stock = quantity;
                        saveData('products', state.products);

                        // Record stock adjustment
                        const stockAdjustment = {
                            id: 'ADJ-' + Date.now(),
                            productId: productId,
                            productName: product.name,
                            quantity: adjustment,
                            reason: 'manual_adjustment',
                            notes: 'Manual stock adjustment',
                            timestamp: new Date().toISOString()
                        };

                        let stockAdjustments = JSON.parse(localStorage.getItem('stockAdjustments') || '[]');
                        stockAdjustments.push(stockAdjustment);
                        saveData('stockAdjustments', stockAdjustments);

                        renderInventoryTable();
                        renderProducts(); // Update POS view
                    } else {
                        alert('Please enter a valid number');
                    }
                }
            }
        }

        function exportInventory() {
            alert('In a real application, this would export inventory data as a CSV file');
        }

        // Customer Management Functions
        function renderCustomersTable() {
            const customersTable = document.getElementById('customersTable');
            customersTable.innerHTML = '';

            state.customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.name}</td>
                    <td>${customer.phone || 'N/A'}</td>
                    <td>${customer.email || 'N/A'}</td>
                    <td>${customer.loyaltyPoints}</td>
                    <td>${state.businessSettings.currencySymbol} ${customer.totalSpent.toLocaleString()}</td>
                    <td>${new Date(customer.lastPurchase).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-secondary btn-sm edit-customer" data-id="${customer.id}">Edit</button>
                        <button class="btn btn-danger btn-sm delete-customer" data-id="${customer.id}">Delete</button>
                    </td>
                `;
                customersTable.appendChild(row);
            });

            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-customer').forEach(button => {
                button.addEventListener('click', function () {
                    editCustomer(this.dataset.id);
                });
            });

            document.querySelectorAll('.delete-customer').forEach(button => {
                button.addEventListener('click', function () {
                    deleteCustomer(this.dataset.id);
                });
            });
        }

        function filterCustomersTable() {
            const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#customersTable tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function showAddCustomerModal() {
            state.editingCustomer = null;
            document.getElementById('customerModalTitle').textContent = 'Add Customer';
            document.getElementById('customerForm').reset();
            document.getElementById('customerModal').classList.remove('hidden');
        }

        function hideCustomerModal() {
            document.getElementById('customerModal').classList.add('hidden');
        }

        function editCustomer(customerId) {
            const customer = state.customers.find(c => c.id === customerId);
            if (customer) {
                state.editingCustomer = customer;
                document.getElementById('customerModalTitle').textContent = 'Edit Customer';
                document.getElementById('customerNameModal').value = customer.name;
                document.getElementById('customerPhone').value = customer.phone || '';
                document.getElementById('customerEmail').value = customer.email || '';
                document.getElementById('customerAddress').value = customer.address || '';
                document.getElementById('customerModal').classList.remove('hidden');
            }
        }

        function saveCustomer(e) {
            e.preventDefault();

            const customerData = {
                name: document.getElementById('customerNameModal').value,
                phone: document.getElementById('customerPhone').value,
                email: document.getElementById('customerEmail').value,
                address: document.getElementById('customerAddress').value
            };

            if (state.editingCustomer) {
                // Update existing customer
                Object.assign(state.editingCustomer, customerData);
            } else {
                // Add new customer
                customerData.id = 'CUST-' + Date.now();
                customerData.loyaltyPoints = 0;
                customerData.totalSpent = 0;
                customerData.lastPurchase = new Date().toISOString();
                state.customers.push(customerData);
            }

            saveData('customers', state.customers);
            hideCustomerModal();
            renderCustomersTable();
        }

        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                state.customers = state.customers.filter(c => c.id !== customerId);
                saveData('customers', state.customers);
                renderCustomersTable();
            }
        }

        function importCustomers() {
            alert('In a real application, this would allow importing customers from a CSV file');
        }

        // Customization Functions
        function updatePreview() {
            document.getElementById('previewStoreName').textContent = document.getElementById('storeName').value || 'Store Name';
            document.getElementById('previewMotto').textContent = document.getElementById('storeMotto').value || 'Store Motto';
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('previewLogo').src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function handleWallpaperUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('previewWallpaper').style.backgroundImage = `url(${e.target.result})`;
                    // Calculate brightness and update text colors
                    calculateWallpaperBrightness(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function saveCustomization() {
            // Get values from form
            state.customization.storeName = document.getElementById('storeName').value || 'Offline POS System';
            state.customization.storeMotto = document.getElementById('storeMotto').value;

            // Get logo if uploaded
            const logoFile = document.getElementById('storeLogo').files[0];
            if (logoFile) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    state.customization.logo = e.target.result;
                    saveCustomizationData();
                };
                reader.readAsDataURL(logoFile);
            } else {
                saveCustomizationData();
            }

            // Get wallpaper if uploaded
            const wallpaperFile = document.getElementById('wallpaper').files[0];
            if (wallpaperFile) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    state.customization.wallpaper = e.target.result;
                    saveCustomizationData();
                };
                reader.readAsDataURL(wallpaperFile);
            } else {
                saveCustomizationData();
            }
        }

        function saveCustomizationData() {
            // Save customization to localStorage
            saveData('customization', state.customization);

            // Apply changes
            applyCustomization();

            alert('Customization saved successfully!');
        }

        // Settings Functions
        function syncData() {
            // In a real app, this would sync with a server
            // For this demo, we'll just update the sync status
            document.getElementById('syncStatus').textContent = 'Online';
            document.getElementById('syncStatus').className = 'status-online';

            // Simulate sync process
            setTimeout(() => {
                document.getElementById('syncStatus').textContent = 'Offline';
                document.getElementById('syncStatus').className = 'status-offline';
                alert('Data sync completed (simulated)');
            }, 2000);
        }

        function clearAllData() {
            if (confirm('This will delete all data including products, transactions, and users. Are you sure?')) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
